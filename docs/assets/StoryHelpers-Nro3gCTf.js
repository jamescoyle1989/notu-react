var f=Object.defineProperty,w=(r,t,e)=>t in r?f(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,s=(r,t,e)=>(w(r,typeof t!="symbol"?t+"":t,e),e);class h{constructor(){s(this,"state","NEW")}new(){return this.state="NEW",this}clean(){return this.state="CLEAN",this}dirty(){return this.state="DIRTY",this}delete(){return this.state="DELETED",this}get isNew(){return this.state=="NEW"}get isClean(){return this.state=="CLEAN"}get isDirty(){return this.state=="DIRTY"}get isDeleted(){return this.state=="DELETED"}validate(t=!1){return!0}}class n extends h{constructor(t=""){super(),s(this,"_id",0),s(this,"_space",null),s(this,"_name",""),s(this,"_color",null),s(this,"_isPublic",!1),this._name=t}get id(){return this._id}set id(t){if(!this.isNew)throw Error("Cannot change the id of a Tag once it has already been created.");this._id=t}get space(){return this._space}set space(t){var e;if(t!==this._space){const i=(t==null?void 0:t.id)!=((e=this._space)==null?void 0:e.id);this._space=t,this.isClean&&i&&this.dirty()}}in(t){return this.space=t,this}get name(){return this._name}set name(t){t!==this._name&&(this._name=t,this.isClean&&this.dirty())}getQualifiedName(t){var e;return t==((e=this.space)==null?void 0:e.id)?this.name:`${this.space.name}.${this.name}`}get color(){return this._color}set color(t){t!==this._color&&(this._color=t,this.isClean&&this.dirty())}get isPublic(){return this._isPublic}set isPublic(t){if(!this.isNew&&this.isPublic&&!t)throw Error("Cannot change a tag from public to private once its already been saved.");t!==this._isPublic&&(this._isPublic=t,this.isClean&&this.dirty())}asPublic(){return this.isPublic=!0,this}asPrivate(){return this.isPublic=!1,this}duplicate(){const t=new n(this.name);return t.id=this.id,t.state=this.state,t.color=this.color,t.space=this.space,t.isPublic=this.isPublic,t}validate(t=!1){let e=null;if(!this.isNew&&this.id<=0?e="Tag id must be greater than zero if in non-new state.":!this.name||!/^[a-zA-Z][a-zA-Z0-9 ]*[a-zA-Z0-9]?$/.test(this.name)?e="Tag name is invalid, must only contain letters, numbers, and spaces, starting with a letter":this.color&&!/^#?[A-z0-9]{6}$/.test(this.color)&&(e="Tag color is invalid, must be a 6 character hexadecimal."),t&&e!=null)throw Error(e);return e==null}getColorInt(){let t=this.color;return t?(t.startsWith("#")&&(t=t.substring(1)),parseInt(t,16)):null}static getColorFromInt(t){return t==null?null:"#"+t.toString(16).toUpperCase().padStart(6,"0")}toJSON(){var t;return{state:this.state,id:this.id,name:this.name,spaceId:(t=this.space)==null?void 0:t.id,color:this.color,isPublic:this.isPublic}}}class o extends h{constructor(t,e){super(),s(this,"id",0),s(this,"_name",""),s(this,"_description",""),s(this,"_type","TEXT"),s(this,"_space",null),s(this,"_color",null),t&&(this.name=t),e&&(this.description=e)}get name(){return this._name}set name(t){t!==this._name&&(this._name=t,this.isClean&&this.dirty())}get description(){return this._description}set description(t){t!==this._description&&(this._description=t,this.isClean&&this.dirty())}get type(){return this._type}set type(t){if(!this.isNew)throw Error("Cannot change an attribute's type once it has been created.");this._type=t}get isText(){return this.type=="TEXT"}get isNumber(){return this.type=="NUMBER"}get isBoolean(){return this.type=="BOOLEAN"}get isDate(){return this.type=="DATE"}asText(){return this.type="TEXT",this}asNumber(){return this.type="NUMBER",this}asBoolean(){return this.type="BOOLEAN",this}asDate(){return this.type="DATE",this}get space(){return this._space}set space(t){var e;if(t!==this._space){const i=(t==null?void 0:t.id)!=((e=this._space)==null?void 0:e.id);this._space=t,this.isClean&&i&&this.dirty()}}in(t){return this.space=t,this}get color(){return this._color}set color(t){t!==this._color&&(this._color=t,this.isClean&&this.dirty())}duplicate(){const t=new o;return t.id=this.id,t.name=this.name,t.description=this.description,t.type=this.type,t.space=this.space,t.color=this.color,t.state=this.state,t}validate(t=!1){let e=null;if(this.space?!this.isNew&&this.id<=0?e="Attr id must be greater than zero if in non-new state.":this.color&&!/^#?[A-z0-9]{6}$/.test(this.color)&&(e="Tag color is invalid, must be a 6 character hexadecimal."):e="Attr must belong to a space.",t&&e!=null)throw Error(e);return e==null}get defaultValue(){switch(this.type){case"TEXT":return"";case"NUMBER":return 0;case"BOOLEAN":return!1;case"DATE":return new Date}}getColorInt(){let t=this.color;return t?(t.startsWith("#")&&(t=t.substring(1)),parseInt(t,16)):null}static getColorFromInt(t){return n.getColorFromInt(t)}toJSON(){var t;return{state:this.state,id:this.id,name:this.name,description:this.description,type:this.type,spaceId:(t=this.space)==null?void 0:t.id,color:this.color}}}class d extends h{constructor(t,e,i){if(super(),s(this,"_tag",null),s(this,"_attr",null),s(this,"_value",null),!t)throw Error("Cannot instanciate new NoteAttr without a passed in attr.");if(t.isNew)throw Error("Cannot create a NoteAttr object for an attr that hasn't been saved yet.");if(t.isDeleted)throw Error("Cannot create a NoteAttr object for an attr marked as deleted.");if(this._attr=t,e){if(e.isNew)throw Error("Cannot create a NoteAttr object linked to a tag that hasn't been saved yet.");if(e.isDeleted)throw Error("Cannot create a NoteAttr object linked to a tag marked as deleted.");this._tag=e}i!=null&&i!=null?this.value=i:this.value=t.defaultValue}get tag(){return this._tag}get attr(){return this._attr}get value(){return this._value}set value(t){this.attr.isText&&typeof t!="string"?t=String(t):this.attr.isDate&&!(t instanceof Date)?t=new Date(t):this.attr.isNumber&&typeof t!="number"?t=Number(t):this.attr.isBoolean&&typeof t!="boolean"&&(t=!!t),t!=this._value&&(this._value=t,this.isClean&&this.dirty())}withValue(t){return this.value=t,this}duplicate(){return new d(this.attr,this.tag,this.value)}validate(t=!1){let e=null;if(t&&e!=null)throw Error(e);return e==null}toJSON(){var t;return{state:this.state,attrId:this.attr.id,tagId:(t=this.tag)==null?void 0:t.id,value:this.value}}}class c extends h{constructor(t){if(super(),s(this,"_tag"),s(this,"_attrs",[]),!t)throw Error("Cannot instanciate new NoteTag without a passed in tag.");if(t.isNew)throw Error("Cannot create a NoteTag object for a tag that hasn't been saved yet.");if(t.isDeleted)throw Error("Cannot create a NoteTag object for a tag marked as deleted.");this._tag=t}get tag(){return this._tag}get attrs(){return this._attrs.filter(t=>!t.isDeleted)}get attrsPendingDeletion(){return this._attrs.filter(t=>t.isDeleted)}addAttr(t,e){if(t.isDeleted)throw Error("Cannot add an attribute marked as deleted.");if(t.isNew)throw Error("Cannot add an attribute that hasn't yet been saved.");const i=new d(t,this.tag,e);return this._attrs.push(i),this}removeAttr(t){const e=this._attrs.find(i=>i.attr.id==t.id);return e?(e.isNew?this._attrs=this._attrs.filter(i=>i!==e):e.delete(),this):this}getAttr(t){return t instanceof o&&(t=t.name),this.attrs.find(e=>e.attr.name==t)}getValue(t){var e;return(e=this.getAttr(t))==null?void 0:e.value}duplicate(){const t=new c(this.tag);return t._attrs=this.attrs.map(e=>e.duplicate()),t}validate(t=!1){function e(i){if(t&&i!=null)throw Error(i);return i==null}if(!this.tag)return e("NoteTag must have a tag set.");for(const i of this._attrs)if(!i.validate(t))return!1;return!0}toJSON(){return{state:this.state,tagId:this.tag.id,attrs:this._attrs.map(t=>t.toJSON())}}}class l extends h{constructor(t=""){super(),s(this,"_id",0),s(this,"_name",""),s(this,"_version","0.0.1"),this._name=t}get id(){return this._id}set id(t){if(!this.isNew)throw Error("Cannot change the id of a Space once it has already been created.");this._id=t}get name(){return this._name}set name(t){t!==this._name&&(this._name=t,this.isClean&&this.dirty())}get version(){return this._version}set version(t){t!==this._version&&(this._version=t,this.isClean&&this.dirty())}v(t){return this.version=t,this}duplicate(){const t=new l;return t.id=this.id,t.name=this.name,t.version=this.version,t.state=this.state,t}validate(t=!1){let e=null;if(!this.isNew&&this.id<=0&&(e="Space id must be greater than zero if in non-new state."),t&&e!=null)throw Error(e);return e==null}toJSON(){return{state:this.state,id:this.id,name:this.name,version:this.version}}}class g extends h{constructor(t,e){super(),s(this,"_id",0),s(this,"_date",new Date),s(this,"_text",""),s(this,"_space",null),s(this,"_ownTag",null),s(this,"_tags",[]),s(this,"_attrs",[]),t&&(this.text=t),this._ownTag=e}get id(){return this._id}set id(t){if(!this.isNew)throw Error("Cannot change the id of a Note once it has already been created.");this._id=t,this.ownTag&&this.ownTag.id!=t&&(this.ownTag.id=t)}get date(){return this._date}set date(t){t!==this._date&&(this._date=t,this.isClean&&this.dirty())}at(t){return this.date=t,this}get text(){return this._text}set text(t){t!==this._text&&(this._text=t,this.isClean&&this.dirty())}get space(){return this._space}set space(t){var e;if(t!==this._space){const i=(t==null?void 0:t.id)!=((e=this._space)==null?void 0:e.id);this._space=t,this.isClean&&i&&this.dirty(),this._setOwnTagSpace()}}in(t){return this.space=t,this}get ownTag(){return this._ownTag}setOwnTag(t){return this.ownTag==null?(this._ownTag=new n(t),this.ownTag.id=this.id):this.ownTag.isDeleted&&this.ownTag.dirty(),this.ownTag.name=t,this._setOwnTagSpace(),this}removeOwnTag(){return this.ownTag?(this.ownTag.isNew?this._ownTag=null:this.ownTag.delete(),this):this}_setOwnTagSpace(){this.ownTag&&this.space&&(this.ownTag.space=this.space)}get tags(){return this._tags.filter(t=>!t.isDeleted)}get tagsPendingDeletion(){return this._tags.filter(t=>t.isDeleted)}addTag(t){if(t.isDeleted)throw Error("Cannot add a tag marked as deleted to a note");if(t.isNew)throw Error("Cannot add a tag that hasn't yet been saved to a note");if(t.id==this.id)throw Error("Note cannot add its own tag as a linked tag");if(!t.isPublic&&t.space.id!=this.space.id)throw Error("Cannot add a private tag from another space");let e=this._tags.find(i=>i.tag.id==t.id);return e?(e.isDeleted&&e.dirty(),e):(e=new c(t),this._tags.push(e),e)}removeTag(t){const e=this._tags.find(i=>i.tag.id==t.id);return e?(e.isNew?this._tags=this._tags.filter(i=>i!==e):e.delete(),this):this}getTag(t,e=null){return t instanceof n?this.tags.find(i=>i.tag===t):(e&&e instanceof l&&(e=e.id),e!=null?this.tags.find(i=>i.tag.name==t&&i.tag.space.id==e):this.tags.find(i=>i.tag.name==t&&i.tag.space.id==this.space.id))}get attrs(){return this._attrs.filter(t=>!t.isDeleted)}get attrsPendingDeletion(){return this._attrs.filter(t=>t.isDeleted)}addAttr(t,e){if(t.isDeleted)throw Error("Cannot add an attribute marked as deleted to a note");if(t.isNew)throw Error("Cannot add an attribute that hasn't yet been saved to a note");const i=new d(t,null,e);return this._attrs.push(i),this}removeAttr(t){const e=this._attrs.find(i=>i.attr.id==t.id);return e?(e.isNew?this._attrs=this._attrs.filter(i=>i!==e):e.delete(),this):this}getAttr(t){return t instanceof o&&(t=t.name),this.attrs.find(e=>e.attr.name==t)}getValue(t){var e;return(e=this.getAttr(t))==null?void 0:e.value}duplicate(){var t;const e=new g(this.text,(t=this.ownTag)==null?void 0:t.duplicate()).at(this.date).in(this.space);return e._attrs=this.attrs.map(i=>i.duplicate()),e._tags=this.tags.map(i=>i.duplicate()),e}toJSON(){var t;return{state:this.state,id:this.id,date:this.date,text:this.text,spaceId:this.space.id,ownTag:(t=this.ownTag)==null?void 0:t.toJSON(),tags:this._tags.map(e=>e.toJSON()),attrs:this._attrs.map(e=>e.toJSON())}}validate(t=!1){function e(a){if(t&&a!=null)throw Error(a);return a==null}if(this.space){if(!this.isNew&&this.id<=0)return e("Note id must be greater than zero if in non-new state.");if(this.ownTag&&this.ownTag.space.id!=this.space.id)return e("Note cannot belong to a different space than its own tag")}else return e("Note must belong to a space.");const i=this.attrs;for(let a=0;a<i.length;a++){const p=i[a];for(let u=a+1;u<i.length;u++){const _=i[u];if(p.attr.id==_.attr.id)return e(`Attr '${p.attr.name}' is duplicated.`)}}if(this.ownTag&&!this.ownTag.validate(t))return!1;for(const a of this._tags)if(!a.validate(t))return!1;for(const a of this._attrs)if(!a.validate(t))return!1;return!0}}function m(r,t=null){const e=new g(r);return e.id=t,e}function N(r,t=null){const e=new l(r);return e.id=t,e}function T(r,t=null){const e=new o(r);return e.id=t,e}function b(r,t=null){const e=new n(r);return e.id=t,e}export{o as A,g as N,T as a,b,m as c,c as d,N as n};
